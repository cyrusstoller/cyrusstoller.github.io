/*
  Copyright 2014, Andrew Cantino and Nicholas Lum, all rights reserved.
*/
(function(){var e=[].slice;window.BeelineUtils={colorIsDark:function(e){var t,o,r,n,i;return i=parseInt(e.substring(1),16),n=255&i>>16,o=255&i>>8,t=255&i>>0,r=.2126*n+.7152*o+.0722*t,80>r},attachElement:function(e){var t;return t=document.getElementsByTagName("head")[0],t?t.appendChild(e):document.body.appendChild(e)},loadScript:function(e,t){var o;return null==t&&(t={}),o=document.createElement("SCRIPT"),o.setAttribute("type","text/javascript"),o.setAttribute("src",e+(t.reload?"?r="+Math.random():"")),this.attachElement(o),null!=t.loads&&null!=t.then?this.whenTrue(function(){return null!=window[t.loads]},t.then):void 0},loadCSS:function(e,t){var o;return null==t&&(t={}),o=document.createElement("LINK"),o.setAttribute("rel","stylesheet"),o.setAttribute("href",e),o.setAttribute("type","text/css"),o.setAttribute("media",t.media||"all"),this.attachElement(o)},removeCSS:function(e){var t,o,r,n,i;for(n=document.querySelectorAll("link[href='"+e+"']"),i=[],o=0,r=n.length;r>o;o++)t=n[o],i.push(t.parentNode.removeChild(t));return i},afterRender:function(e){var t,o=this;return t=function(){var t;try{return e.call(o)}catch(r){return t=r,BeelineUtils.log("Exception in afterRender",t,null!=t?t.stack:void 0)}},window.setTimeout(t,1)},log:function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],"undefined"!=typeof console?"function"==typeof console.log?console.log.apply(console,["BeeLine Reader: "].concat(e.call(t))):void 0:void 0},reload:function(e){return null==e&&(e=null),e&&e.preventDefault(),window.location.reload()},alert:function(e){return alert(e)},urlMatches:function(e){var t,o;return null!=(t=window.location)?null!=(o=t.href)?o.match(e):void 0:void 0},whenTrue:function(e,t){var o;return o=function(){return e()?t():(BeelineUtils.log("Condition hasn't matched, trying again in a moment..."),setTimeout(o,50))},o()},not:function(e){return function(){return!e()}}}}).call(this),/*
  Copyright 2014, Andrew Cantino and Nicholas Lum, all rights reserved.
*/
function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].slice;window.BeeLineReader=function(){function o(t,o){if(null==o&&(o={}),this._resizeHandler=e(this._resizeHandler,this),this.recolor=e(this.recolor,this),this.uncolor=e(this.uncolor,this),this.color=e(this.color,this),!t||t&&t.jquery)throw"A raw DOM Node is required when creating a BeeLineReader instance";this.node=t,this.options=o,this.listeners={},this.reflowNeeded=!0,this.colorCache={},this.tohexCache={},this.coloring=!1,this.abortCount=0,this.browserIsCompatible()&&(this.options.handleResize&&this._setupResizeHandler(),this.options.colorImmediately&&BeelineUtils.afterRender(this.color))}return o.prototype.BEELINE_INDICATOR_CLASS="beeline-node",o.SKIP_COLOR_ATTRIBUTE="data-beeline-skip",o.prototype.NUM_COLORS=4,o.prototype.MIN_COLOR_WIDTH=100,o.prototype.WRAPPER_TYPE="beelinespan",o.THEMES={bright:["#000000","#0000FF","#000000","#FF0500","#FBFBFB"],dark:["#000000","#970000","#000000","#00057F","#FBFBFB"],blues:["#000000","#0000FF","#000000","#840DD2","#FBFBFB"],gray:["#000000","#666666","#000000","#666666","#FBFBFB"],inverted:["#FBFBFB","#56AAFF","#FBFBFB","#9E8DFC","#000000"],custom:["#000000","#0000FF","#000000","#FF0500","#FBFBFB"]},o.DEFAULT_THEME="bright",o.THEME_ORDER=["bright","dark","blues","gray","inverted"],o.prototype.color=function(e){var r,n=this;return this.browserIsCompatible()?(r=function(){var o;return o=1<=arguments.length?t.call(arguments,0):[],n.trigger.apply(n,["afterColor"].concat(t.call(o))),e?e.apply(null,o):void 0},this.trigger("beforeColor"),"custom"===this.getTheme()?this._color(this.node,this.options.customColor1||o.THEMES.custom[0],this.options.customColor2||o.THEMES.custom[1],this.options.customColor3||o.THEMES.custom[2],this.options.customColor4||o.THEMES.custom[3],this.options.customBackground||o.THEMES.custom[4],r):this._color.apply(this,[this.node].concat(t.call(o.THEMES[this.getTheme()]),[r]))):"function"==typeof e?e():void 0},o.prototype.getTheme=function(){return this.options.theme&&o.THEMES[this.options.theme]&&this.options.theme||o.DEFAULT_THEME},o.prototype.setCustom=function(e,t,o,r,n){return this.options.theme="custom",this.options.customColor1=e,this.options.customColor2=t,this.options.customColor3=o,this.options.customColor4=r,this.options.customBackground=n},o.prototype.setOptions=function(e){var t,o,r;r=[];for(t in e)o=e[t],r.push(this.options[t]=o);return r},o.prototype.uncolor=function(){return this.trigger("beforeUncolor"),this._unwrap(this.node),this.options.skipBackgroundColor||this._revertBackground(this.node),this.colored=!1,this.reflowNeeded=!0},o.prototype.recolor=function(e){return this.browserIsCompatible()?(this.trigger("beforeRecolor"),this.reflowNeeded=!0,this.color(e)):"function"==typeof e?e():void 0},o.prototype.cleanup=function(){return this.alreadySetupResizeHandler&&window.removeEventListener("resize",this._resizeHandler,!1),this.trigger("afterCleanup")},o.prototype.bind=function(e,t,o){var r;return(r=this.listeners)[e]||(r[e]=[]),this.listeners[e].push([t,o||this])},o.prototype.trigger=function(){var e,o,r,n,i,s,l,a,u;for(n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],l=this.listeners[n]||[],u=[],i=0,s=l.length;s>i;i++)a=l[i],r=a[0],o=a[1],u.push(r.apply(o,e));return u},o.prototype.browserIsCompatible=function(){var e;return e=this._getInternetExplorerVersion(),-1===e||e>=9},o.prototype._getInternetExplorerVersion=function(){var e,t,o;return t=-1,"Microsoft Internet Explorer"===navigator.appName&&(o=navigator.userAgent,e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!==e.exec(o)&&(t=parseFloat(RegExp.$1))),t},o.prototype._setupResizeHandler=function(){return this.alreadySetupResizeHandler?void 0:(this.alreadySetupResizeHandler=!0,window.addEventListener("resize",this._resizeHandler,!1))},o.prototype._resizeHandler=function(){var e=this;return this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){return BeelineUtils.log("re-coloring after resize"),e.resizeTimer=null,e.recolor()},500)},o.prototype._addClasses=function(e,o){return e.className=t.call(e.className.split(/\s+/)).concat([o]).join(" ")},o.prototype._removeClasses=function(e,t){var o,r;return r=e.className.split(/\s+/),e.className=function(){var e,n,i;for(i=[],e=0,n=r.length;n>e;e++)o=r[e],o.match(t)||i.push(o);return i}().join(" ")},o.prototype._color=function(e,t,o,r,n,i,s){var l=this;return this.abortCount++,BeelineUtils.whenTrue(function(){return!l.coloring},function(){var a;return e.hasChildNodes()?(l.coloring=!0,l.abortCount--,l.options.skipBackgroundColor||(e.style.backgroundColor&&!e.originalBackgroundColor&&(e.originalBackgroundColor=e.style.backgroundColor),e.style.backgroundColor=i),l._removeClasses(e,/^(beeline-colored-area|beeline-theme-\w+)$/g),l._addClasses(e,"beeline-colored-area beeline-theme-"+l.getTheme()),a=[],l.colored||l._makeChildrenSpan(e,a),l._workOff(a,{after:function(){var i,u;return i=e.getBoundingClientRect(),u={xmin:i.left,xmax:i.right,xlast:null,whtSpc:/^\s*$/,whtSpcFlag:0,thisColor:0,xcoord:0,colorOne:t,colorTwo:o,colorThree:r,colorFour:n,elements:[],reflowNeeded:l.reflowNeeded,rtl:"rtl"===(window.getComputedStyle(e,null).direction||"").toLowerCase()},u.xmin===u.xmax&&(u.xmax+=1),a=[],l._calculateSpanPositionsAndColors(e,u,a),l._workOff(a,{abortable:!0,after:function(e){return e&&(l.trigger("coloringAborted"),BeelineUtils.log("aborted coloring")),l.reflowNeeded=!1,l.colored=!0,l.coloring=!1,s?s():void 0}})}})):s?s({error:"This node has no children"}):void 0})},o.prototype._makeChildrenSpan=function(e,t){var r,n,i,s=this;if(1===e.nodeType){if(e=e.firstChild){for(i=[];;){if(r=e.nextSibling,(1!==e.nodeType||"svg"!==(n=e.nodeName.toLowerCase())&&"true"!==e.getAttribute(o.SKIP_COLOR_ATTRIBUTE)&&e.className!==this.BEELINE_INDICATOR_CLASS)&&this._makeChildrenSpan(e,t),!(e=r))break;i.push(void 0)}return i}}else if(3===e.nodeType)return t.push(function(){var t,o,r,n,i,l,a,u,c,h;if(l=e.length,l&&!/^\s*$/.test(e.nodeValue)&&(a=e.cloneNode(0),t=e.cloneNode(0),o=document.createElement(s.WRAPPER_TYPE),o.appendChild(t),c=e.parentNode)){for(c.replaceChild(o,e),r=h=0;l>=0?l>h:h>l;r=l>=0?++h:--h)n=document.createElement(s.WRAPPER_TYPE),n.className=s.BEELINE_INDICATOR_CLASS,u=a.nodeValue.charAt(r),i=document.createTextNode(u),n.appendChild(i),c.insertBefore(n,o);return c.removeChild(o)}})},o.prototype._calculateSpanPositionsAndColors=function(e,t,o){var r,n=this;if(1===e.nodeType&&e.className!==this.BEELINE_INDICATOR_CLASS){if(e=e.firstChild){for(r=[];;){if(this._calculateSpanPositionsAndColors(e,t,o),!(e=e.nextSibling))break;r.push(void 0)}return r}}else if(1===e.nodeType&&e.className===this.BEELINE_INDICATOR_CLASS)return o.push(function(){var o,r,i,s;return null===e.firstChild.nodeValue||t.whtSpc.test(e.firstChild.nodeValue)?void 0:(t.reflowNeeded?(s=e.getBoundingClientRect().left,e.cachedBeeLineXPosition=s):s=e.cachedBeeLineXPosition||e.getBoundingClientRect().left,t.xlast=null===t.xlast?t.xmin:t.xcoord,t.xcoord=s,i=t.rtl?t.xcoord-t.xlast>0:t.xcoord-t.xlast<0,i&&(t.thisColor+=1,t.thisColor%=n.NUM_COLORS),t.thisColor<2?(r=t.colorOne,o=t.colorTwo):(r=t.colorThree,o=t.colorFour),e.style.color=t.rtl?n._getColor(t.thisColor,s,t.xmin,t.xmax,o,r):n._getColor(t.thisColor,s,t.xmin,t.xmax,r,o))})},o.prototype._getColor=function(e,t,o,r,n,i){var s,l,a,u,c,h,d,p,f,g,m,C,_,T,E,y,v,B,b,x,w,S,N;switch(this.colorCache[n+i]?(N=this.colorCache[n+i],u=N[0],f=N[1],a=N[2],p=N[3],l=N[4],d=N[5]):(u=this._hexToR(i),f=this._hexToR(n),a=this._hexToG(i),p=this._hexToG(n),l=this._hexToB(i),d=this._hexToB(n),this.colorCache[n+i]=[u,f,a,p,l,d]),S=w=x=0,s=3.1415/(r-o),g=u-f,h=a-p,c=l-d,m=C=b=y=B=v=_=E=E=0,e){case 0:m=t-o,C=s*m,b=C-3.1415,E=Math.cos(b),E+=1,E/=2,B=g*E,B+=f,v=h*E,v+=p,_=c*E,_+=d,S=Math.round(B),w=Math.round(v),x=Math.round(_);break;case 1:m=t-o,C=s*m,y=C,T=Math.cos(y),T+=1,T/=2,B=g*T,B+=f,v=h*T,v+=p,_=c*T,_+=d,S=Math.round(B),w=Math.round(v),x=Math.round(_);break;case 2:m=t-o,C=s*m,b=C-3.1415,E=Math.cos(b),E+=1,E/=2,B=g*E,B+=f,v=h*E,v+=p,_=c*E,_+=d,S=Math.round(B),w=Math.round(v),x=Math.round(_);break;case 3:m=t-o,C=s*m,y=C,T=Math.cos(y),T+=1,T/=2,B=g*T,B+=f,v=h*T,v+=p,_=c*T,_+=d,S=Math.round(B),w=Math.round(v),x=Math.round(_);break;default:S=127,w=127,x=127}return this._rgbToHex(S,w,x)},o.prototype._rgbToHex=function(e,t,o){return"#"+this._toHex(e)+this._toHex(t)+this._toHex(o)},o.prototype._toHex=function(e){var t;if(!(t=this.tohexCache[e])){if(e=parseInt(e,10),isNaN(e))return"00";e=Math.max(0,Math.min(e,255)),t="0123456789ABCDEF".charAt((e-e%16)/16)+"0123456789ABCDEF".charAt(e%16),this.tohexCache[e]=t}return t},o.prototype._hexToR=function(e){return parseInt(this._cutHex(e).substring(0,2),16)},o.prototype._hexToG=function(e){return parseInt(this._cutHex(e).substring(2,4),16)},o.prototype._hexToB=function(e){return parseInt(this._cutHex(e).substring(4,6),16)},o.prototype._cutHex=function(e){return"#"===e.charAt(0)?e.substring(1,7):e},o.prototype._time=function(e,t){var o,r;return r=(new Date).getTime(),t(),o=(new Date).getTime(),BeelineUtils.log(""+e+" took "+(o-r)+"ms")},o.prototype._revertBackground=function(e){return e.style.backgroundColor=e.originalBackgroundColor||""},o.prototype._unwrap=function(e){var t,o,r,n,i,s,l,a,u,c;for(t=[],n=[],u=e.getElementsByClassName(this.BEELINE_INDICATOR_CLASS),i=0,l=u.length;l>i;i++)o=u[i],0===t.length||o===t[t.length-1].nextSibling?t.push(o):(n.push(t),t=[o]);for(t.length>0&&n.push(t),c=[],s=0,a=n.length;a>s;s++)r=n[s],c.push(this._mergeContents(r));return c},o.prototype._mergeContents=function(e){var t,o,r,n,i,s,l,a,u,c;for(o=e[0].parentNode,r="",n=0,s=e.length;s>n;n++)t=e[n],null!==(null!=(a=t.firstChild)?a.nodeValue:void 0)&&(r+=t.firstChild.nodeValue);for(o.replaceChild(document.createTextNode(r),e[0]),u=e.slice(1,e.length),c=[],i=0,l=u.length;l>i;i++)t=u[i],c.push(o.removeChild(t));return c},o.prototype._workOff=function(e,t){var o,r,n=this;for(null==t&&(t={}),r=(new Date).getTime();(new Date).getTime()-r<20&&(o=e.shift());)o();if(e.length>0&&t.abortable&&this.abortCount>0){if(t.after)return t.after(!0)}else{if(e.length>0)return BeelineUtils.afterRender(function(){return n._workOff(e,t)});if(t.after)return t.after()}},o}()}.call(this);